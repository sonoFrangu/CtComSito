<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CT Communication â€” Induno</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="text-white bg-neutral-950">
    <div class="bg-animated" aria-hidden="true">
      <div class="blob blob--blue"></div>
      <div class="blob blob--violet"></div>
      <div class="blob blob--green"></div>
    </div>

    <div id="header"></div>

    <section id="galleria" class="section">
      <div class="container">
        <h1 class="mb-6 text-4xl font-extrabold md:text-5xl" data-aos="fade-up">Galleria</h1>

        <div class="grid gap-4 sm:grid-cols-2 md:grid-cols-3" id="gallery-grid-induno"></div>
        <p id="gallery-empty-induno" class="hidden mt-2 text-sm text-neutral-400">Nessuna foto trovata per Induno.</p>
      </div>
    </section>

    <div id="footer"></div>

    <script type="module">
      import { renderHeader, renderFooter, renderTeam, enablePageTransitions } from "./components.js";
      import { supabase } from './lib/supabase.js';
      document.getElementById("header").innerHTML = renderHeader("");
      document.getElementById("footer").innerHTML = renderFooter();

      async function loadGalleryInduno() {
        const grid = document.getElementById('gallery-grid-induno');
        const empty = document.getElementById('gallery-empty-induno');
        try {
          const { data, error } = await supabase
            .from('gallery')
            .select('path')
            .eq('sede', 'induno')
            .order('created_at', { ascending: false })
            .limit(6);
          if (error) throw error;
          if (!data || data.length === 0) {
            empty.classList.remove('hidden');
            grid.innerHTML = '';
            return;
          }
          const cards = data.map((r, i) => {
            const { data: pub } = supabase.storage.from('induno-gallery').getPublicUrl(r.path);
            const url = pub?.publicUrl || `/storage/v1/object/public/induno-gallery/${r.path}`;
            const delay = i * 50;
            return `
              <div class="overflow-hidden card" data-aos="fade-up"${delay ? ` data-aos-delay="${delay}"` : ''}>
                <img src="${url}" alt="Induno ${i+1}" class="object-cover w-full h-48" />
              </div>`;
          }).join('');
          grid.innerHTML = cards;
          empty.classList.add('hidden');
        } catch (e) {
          console.error('[gallery induno]', e);
          empty.textContent = 'Errore nel caricamento della galleria.';
          empty.classList.remove('hidden');
        }
      }

      await loadGalleryInduno();

      enablePageTransitions();
    </script>
  </body>
</html>